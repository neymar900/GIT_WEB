<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>POS ‚Äì Restaurante Familiar</title>

<style>
:root{
  --accent:#e85a13;
  --card:#ffffff;
  --muted:#6b7280;
}

/* ===== BASE ===== */
html,body{margin:0;height:100%}
body{
  font-family: "Segoe UI", Arial, sans-serif;
  background:url("Imagenes/fondoWEB.avif") center/cover fixed no-repeat;
  color:#111;
}

.container{
  max-width:1200px;
  margin:auto;
  padding:20px;
  backdrop-filter: blur(1px);
}

/* ===== HEADER ===== */
.header{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:14px;
}
.brand{
  font-size:24px;
  font-weight:800;
  color:var(--accent);
}

/* ===== BOTONES (TODOS NARANJA) ===== */
button,.btn{
  background:var(--accent);
  color:#fff;
  border:0;
  padding:9px 14px;
  border-radius:10px;
  cursor:pointer;
  font-weight:700;
  box-shadow:0 8px 22px rgba(232,90,19,.25);
}
button:hover{transform:translateY(-1px)}
button:disabled{opacity:.6}

/* ===== FILTROS ===== */
.panel{
  background:rgba(255,255,255,.92);
  padding:12px;
  border-radius:14px;
  margin-bottom:16px;
}
.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
input,select{
  padding:8px;
  border-radius:8px;
  border:1px solid #ddd;
}

/* ===== GRID ===== */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:18px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:12px;
  box-shadow:0 10px 26px rgba(0,0,0,.1);
  display:flex;
  flex-direction:column;
  gap:8px;
}

.card img{
  width:100%;
  height:140px;
  object-fit:cover;
  border-radius:10px;
}

.card .title{font-weight:800}
.card .cat{
  background:#fff1e8;
  color:var(--accent);
  font-size:12px;
  padding:4px 8px;
  border-radius:999px;
  width:max-content;
}
.card .price{
  color:var(--accent);
  font-size:18px;
  font-weight:800;
}

.row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px;
}

/* ===== SECCIONES ===== */
.section{
  background:rgba(255,255,255,.92);
  padding:16px;
  border-radius:14px;
  margin-top:18px;
}

/* ===== CONFIG ===== */
.config-btn{
  margin-left:auto;
}

/* ===== TOAST ===== */
.toast{
  position:fixed;
  right:20px;
  bottom:20px;
  background:#111;
  color:#fff;
  padding:10px 14px;
  border-radius:10px;
  display:none;
  z-index:9999;
}
</style>
</head>

<body>
<div class="container">

  <!-- HEADER -->
  <div class="header">
    <div class="brand">üçΩ POS ‚Äì Restaurante Familiar</div>
    <button id="btnConfig" class="config-btn">‚öô Configuraci√≥n</button>
  </div>

  <!-- FILTROS -->
  <div class="panel">
    <div class="controls">
      <input id="search" placeholder="Buscar producto...">
      <select id="filtrocategoria"><option value="">Todas</option></select>
      <select id="metrica">
        <option value="precio">Ordenar por precio</option>
        <option value="nombre">Ordenar por nombre</option>
      </select>
      <button id="btnRefrescar">Actualizar</button>
    </div>
  </div>

  <!-- PRODUCTOS -->
  <div id="grid" class="grid"></div>

  <!-- REGISTRO RAPIDO -->
  <div class="section">
    <div class="controls">
      <select id="quickSelect" style="min-width:260px"></select>
      <input id="quickQty" type="number" value="1" min="1">
      <select id="quickPago">
        <option value="efectivo">Efectivo</option>
        <option value="tarjeta">Tarjeta</option>
      </select>
      <button id="quickSell">Vender</button>
    </div>
  </div>

  <!-- REPORTE -->
  <div class="section">
    <h3>Reporte</h3>
    <select id="selectDias">
      <option value="7">√öltimos 7 d√≠as</option>
      <option value="30">√öltimos 30 d√≠as</option>
    </select>
    <div id="reportInfo" style="margin-top:8px;font-weight:700;color:var(--accent)"></div>
    <div id="reportTable"></div>
  </div>

  <!-- CONFIG API (OCULTO) -->
  <div id="configPanel" class="section" style="display:none">
    <h3>Configuraci√≥n API</h3>
    <input id="apiUrl" style="width:100%" placeholder="Pega tu URL Apps Script">
    <div style="margin-top:8px;display:flex;gap:8px">
      <button id="guardarApi">Guardar</button>
      <button id="probarApi">Probar</button>
    </div>
  </div>

</div>

<div id="toast" class="toast"></div>

<script>
const $=id=>document.getElementById(id);
let API_URL=localStorage.getItem("api_url_rest")||"";
let MENU=[];

const IMG={
 chicharron:"chicharron.jpg",
 escabeche:"escabeche.jpg",
 chorizo:"chorizo.jpg",
 fricase:"fricase.webp",
 chichadoble:"chicha.jpg",
 chichalata:"chicha.jpg",
 chichabalde:"chicha.jpg",
 chichaalojadoble:"chichaMorada.webp",
 chichaalojalata:"chichaMorada.webp",
 chichaalojabalde:"chichaMorada.webp",
 cervezaunidad:"cerveza.jpg",
 refresco2l:"Refresco2L.webp",
 refresco3l:"3L.webp"
};

const norm=s=>s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"");

function toast(m){
 const t=$("toast");
 t.textContent=m;t.style.display="block";
 setTimeout(()=>t.style.display="none",2500);
}

function imgFor(i){
 if(i.imagen) return "Imagenes/"+i.imagen;
 return "Imagenes/"+(IMG[norm(i.nombre)]||"fondoWEB.avif");
}

async function loadMenu(){
 if(!API_URL) return;
 const r=await fetch(API_URL+"?action=menu");
 MENU=await r.json();
 loadCats();loadQuick();renderMenu();updateReport();
}

function renderMenu(){
 const q=$("search").value.toLowerCase();
 const c=$("filtrocategoria").value;
 const m=$("metrica").value;
 let list=[...MENU];
 if(q) list=list.filter(i=>i.nombre.toLowerCase().includes(q));
 if(c) list=list.filter(i=>i.categoria===c);
 if(m==="precio") list.sort((a,b)=>a.precio-b.precio);
 if(m==="nombre") list.sort((a,b)=>a.nombre.localeCompare(b.nombre));
 $("grid").innerHTML=list.map(i=>`
  <div class="card">
    <img src="${imgFor(i)}">
    <div class="title">${i.nombre}</div>
    <div class="cat">${i.categoria}</div>
    <div class="price">Bs ${i.precio}</div>
    <div class="row">
      <input id="qty_${i.id}" type="number" value="1">
      <button onclick="sell(${i.id})">Vender</button>
    </div>
  </div>`).join("");
}

function loadCats(){
 const c=[...new Set(MENU.map(i=>i.categoria))];
 $("filtrocategoria").innerHTML=`<option value="">Todas</option>`+c.map(x=>`<option>${x}</option>`).join("");
}
function loadQuick(){
 $("quickSelect").innerHTML=MENU.map(i=>`<option value="${i.id}">${i.nombre} - Bs ${i.precio}</option>`).join("");
}

async function sell(id){
 const it=MENU.find(x=>x.id==id);
 const q=$("qty_"+id).value;
 sendSale(it,q);
}
async function sendSale(it,q,p="efectivo"){
 const f=new URLSearchParams();
 f.append("action","registrar_venta");
 f.append("producto_id",it.id);
 f.append("producto_nombre",it.nombre);
 f.append("cantidad",q);
 f.append("precio_unitario",it.precio);
 f.append("total",it.precio*q);
 f.append("pago",p);
 await fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:f});
 toast("Venta registrada");
 updateReport();
}

async function updateReport(){
 const d=$("selectDias").value;
 const r=await fetch(API_URL+"?action=reporte&dias="+d);
 const j=await r.json();
 $("reportInfo").textContent=`Ingresos: Bs ${j.ingresos_totales}`;
 $("reportTable").innerHTML="<ul>"+j.items.map(i=>`<li>${i.nombre}: ${i.cantidad}</li>`).join("")+"</ul>";
}

/* eventos */
$("search").oninput=renderMenu;
$("filtrocategoria").onchange=renderMenu;
$("metrica").onchange=renderMenu;
$("btnRefrescar").onclick=renderMenu;
$("quickSell").onclick=()=>sendSale(MENU.find(x=>x.id==$("quickSelect").value),$("quickQty").value,$("quickPago").value);
$("selectDias").onchange=updateReport;
$("btnConfig").onclick=()=>$("configPanel").style.display=$("configPanel").style.display==="block"?"none":"block";
$("guardarApi").onclick=()=>{API_URL=$("apiUrl").value;localStorage.setItem("api_url_rest",API_URL);toast("API guardada");loadMenu();}
$("probarApi").onclick=async()=>toast((await fetch(API_URL+"?action=menu")).ok?"API OK":"Error API");

/* init */
(function(){ $("apiUrl").value=API_URL; if(API_URL) loadMenu(); })();
</script>
</body>
</html>
